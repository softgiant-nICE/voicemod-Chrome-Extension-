(()=>{"use strict";class e{constructor(e){this.config=e}write(){"prod"!==this.config&&console.log(Array.from(arguments))}write_method_call({obj:e,class_name:t,method_name:n,args:o,output:r,error:s,stub:a,stack:i,ignore:c}){if(!c&&"prod"!==this.config){let c="eggshell";c=a?"yellow":s?"red":"white",console.groupCollapsed("%c "+t+"."+n,`color: ${c}`),console.log("this:"),console.log(e),console.log("input:");for(var l=0;l<o.length;l++)console.log(o[l]);console.log(o),console.log("output:"),console.log(r),s&&console.log(i),console.groupEnd()}}do_not_log(){}do_log(){}}class t{dig(e,t,n){e.add(n);let o=Object.keys(n);for(let r=o.length,s=0;s<r;s++){let r=o[s],a=n[r];if(a&&!e.has(a))if("string"==typeof a)console.log(t.join("."),r,a);else if("object"==typeof a){let n=JSON.parse(JSON.stringify(t));n.push(r),dig(e,n,a)}}}detect_changes(e,t,n){let o=0;new MutationObserver((()=>{Date.now(),intervalc,o=Date.now()})).observe(e,{attributes:!0,childList:!0,subtree:!0}),setInterval((()=>{}),t),n()}inject_js(){let e=document.createElement("script");e.src=chrome.runtime.getURL("/js/injected.js"),document.documentElement.append(e)}async inject_css(){var e=await this.fetch_text(this.get_url("/css/content.css"));document.documentElement.append(this.html_to_element(`<style>${e}</style>`))}get_iframe_src(){return"dev"===this.config.mode?"http://localhost:2010/":chrome.runtime.getURL("/pages/app/index.html")}find_text_input(e){return Array.from(e.querySelectorAll("input, textarea")).filter((e=>"text"===e.type||"textarea"===e.type||"number"===e.type||"email"===e.type))[0]}constructor(t){this.config=t,this.log=new e(t)}get_url(e){return chrome.runtime.getURL(e)}get_value(e){let t=$(e).get(0);return t?"META"===t.tagName?t.getAttribute("content").trim():t.textContent.trim():"Not available"}async wait(e){return new Promise((t=>{setTimeout(t,e)}))}decode_json(e){try{return JSON.parse(e)}catch(e){return null}}clone(e){try{return JSON.parse(JSON.stringify(e))}catch(e){return null}}is_undefined(e){return void 0===e}list_is_empty(e){return 0===e.length}object_is_empty(e){return 0===Object.keys(e).length}async fetch_json(e,t){let n=await fetch(e,t),o=await n.text();try{return JSON.parse(o)}catch(e){return console.log("error"),console.log(e),null}}async fetch_text(e){let t=await fetch(e);return await t.text()}async wait_for_ready_state_complete(){for(;;){if("complete"===document.readyState)return;await this.wait(200)}}async wait_for_element(e){for(let t=0;t<1e3;t++){let t=document.querySelector(e);if(t)return t;await this.wait(100)}}simulate(e,t){e.dispatchEvent(new Event(t,{bubbles:!0}))}html_to_element(e){let t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}run_complex_selector(e){if(e.root_css)(t=document.querySelector(e.root_css))||(t=document);else if(e.root_element)var t=e.root_element;else t=document;if(e.css)var n=Array.from(t.querySelectorAll(e.css));else n=Array.from(t.querySelectorAll("*"));if(e.inner_text)for(var o=n.length;o--;)n[o].innerText!==e.inner_text&&n.splice(o,1);if(e.inner_text_includes)for(o=n.length;o--;)!1===n[o].innerText.toLowerCase().includes(e.inner_text_includes)&&n.splice(o,1);if(e.style){var r=Object.keys(e.style),s=null;e:for(o=n.length;o--;){s=window.getComputedStyle(n[o]);for(var a=r.length;a--;)if(e.style[r[a]]!==s[r[a]]){n.splice(o,1);continue e}}}if(e.min_area)for(let t=n.length;t--;){let o=n[t].getBoundingClientRect();o.width*o.height<e.min_area&&n.splice(t,1)}return n}find_element(e){for(var t=0;t<e.length;t++){var n=this.run_complex_selector(e[t]);if(n&&n.length>0)return n[0]}return null}find_elements(e){for(var t=0;t<e.length;t++){var n=this.run_complex_selector(e[t]);return n&&n.length>0?n:[]}return null}bg_fetch(e,t){return new Promise((n=>{chrome.runtime.sendMessage({name:"fetch_json",data:{url:e,data:t}},(e=>{n(e)}))}))}create_iframe_wrap(e){let t=new Promise((t=>{let n=o=>{if(o.data&&"iframe_ready"===o.data.name&&e.contentWindow===o.source){console.log("iframe_ready",o.source);let e=o.source;window.removeEventListener("message",n),t(this.create_window_wrap(window,e))}};window.addEventListener("message",n)}));return{exec:(e,n)=>t.then((t=>t.exec(e,n)))}}create_window_wrap(e,t){let n=[];return e.addEventListener("message",(async e=>{if(e.data){let t=e.data.name,o=e.data.meta,r=e.data.data;"exec_result"===t&&o&&o.response&&n[o.request_id]&&n[o.request_id](r.result)}})),{exec:(e,o)=>new Promise((r=>{let s=n.length;n.push(r);let a={request_id:s,request:!0};t.postMessage({name:e,meta:a,data:o},"*")}))}}create_window_api(e){window.addEventListener("message",(async t=>{if(t.data){let n=t.data.name,o=t.data.meta,r=t.data.data;if(e[n]){let s=await e[n](r);t.source.postMessage({name:"exec_result",meta:{response:!0,request_id:o,request_id:o.request_id},data:{result:s}},"*")}}}))}create_runtime_api(e){chrome.runtime.onMessage.addListener((function(t,n,o){return console.log(e,t),e[t.name]?(t.data&&t.data._sender&&(t.data._sender=n),e[t.name](t.data).then(o)):o(null),!0}))}runtime_exec(e,t){return new Promise((n=>{chrome.runtime.sendMessage({name:e,data:t},n)}))}parse_rows(e){for(var t=[],n=null,o=e[0],r=1;r<e.length;r++){n={};for(var s=0;s<o.length;s++)n[o[s]]=e[r][s];t.push(n)}return t}get_methods(e){return Object.getOwnPropertyNames(e).filter((t=>"function"==typeof e[t]))}wrap_class(e,t){t=t||[];let n=this,o=e.name;this.get_methods(e.prototype).forEach((r=>{let s=e.prototype[r];e.prototype[r]=function(){let e={ignore:t.includes(r),obj:this,class_name:o,method_name:r,args:Array.from(arguments)},a=n.stubs;if(a&&a[0]&&a[0].class_name===o&&a[0].method_name===r)return e.stub=!0,e.output=a[0].output,a.splice(0,1),n.log.write_method_call(e),e.output;try{e.output=s.apply(this,arguments)}catch(t){e.error=!0,e.stack=t.stack,e.output=null}return e.output&&e.output.then?e.output=new Promise((t=>{e.output.then((o=>{e.output=o,n.log.write_method_call(e),t(o)})).catch((o=>{e.error=!0,e.stack=o.stack,e.output=null,n.log.write_method_call(e),t(null)}))})):n.log.write_method_call(e),e.output}}))}set_stubs(e){this.stubs=e}post_window_message(e,t,n){e.postMessage({name:t,data:n},"*")}blob_to_base64(e){return new Promise((t=>{const n=new FileReader;n.onloadend=()=>{t(n.result)},n.readAsDataURL(e)}))}download_string(e,t){var n=new Blob([e],{type:"text/plain"}),o=URL.createObjectURL(n),r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=o,r.download=t,r.click(),window.URL.revokeObjectURL(o)}download_blob(e,t){var n=URL.createObjectURL(e),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",o.href=n,o.download=t,o.click(),window.URL.revokeObjectURL(n)}find(e,t,n){for(var o=0;o<e.length;o++)if(e[o][t]===n)return e[o];return null}update_object(e,t){Object.keys(t).forEach((n=>{null!==e[n]&&"object"==typeof e[n]?this.update_object(e[n],t[n]):e[n]=t[n]}))}rows_to_data_arr(e){for(var t=[],n=null,o=e[0],r=1;r<e.length;r++){n={};for(var s=0;s<o.length;s++)n[o[s]]=e[r][s];t.push(n)}return t}to_data_url(e){return new Promise((t=>{var n=new XMLHttpRequest;n.onload=function(){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n.response)},n.open("GET",e),n.responseType="blob",n.send()}))}}const n=new class{timeout(e){return new Promise((t=>{setTimeout((()=>{t()}),e)}))}blob_to_base64(e){return new Promise(((t,n)=>{const o=new FileReader;o.onloadend=()=>t(o.result),o.readAsDataURL(e)}))}},o=new class{constructor(){this.mini_popup=null}async append_mini_popup(){if(this.mini_popup){const e={reason:"go_to",data:{page_name:"init"}};return this.send_msg_to_mini_popup(e),await n.timeout(0),void this.show_mini_popup()}const e=this._create_iframe("mini-popup","soundboard-mini-popup");e.classList.add("chromane-hide"),this.mini_popup=e,document.body.append(e),await n.timeout(100),e.classList.remove("chromane-hide")}hide_mini_popup(){this.mini_popup&&this.mini_popup.classList.add("chromane-hide")}show_mini_popup(){this.mini_popup&&this.mini_popup.classList.contains("chromane-hide")&&this.mini_popup.classList.remove("chromane-hide")}send_msg_to_mini_popup(e){this.mini_popup&&this.mini_popup.contentWindow.postMessage(e,"*")}_create_iframe(e,t){const n=document.createElement("iframe"),o=chrome.runtime.id;n.src=`chrome-extension://${o}/pages/popup/index.html`;const r={context:e};return n.name=JSON.stringify(r),n.id=t,n}};let r=document.createElement("script");r.src=chrome.runtime.getURL("/js/injected.js"),document.documentElement.prepend(r),async function(){const e={is_record_active:!1,record_state:"init",is_e_key_pressed:!1,is_combination_pressed:!1};(new t).create_window_api({fetch_voice:async e=>{console.log("fetch_voice");const t=await chrome.runtime.sendMessage({reason:"fetch_voice",data:{base64:e}});return console.log("resp_base64",t),t},start_record:async t=>{o.append_mini_popup(),e.record_state="record"},generete_record:async()=>(o.send_msg_to_mini_popup({reason:"go_to",data:{page_name:"generete"}}),await n.timeout(0),o.show_mini_popup(),e.record_state="generete",!0),play_record:async()=>(o.send_msg_to_mini_popup({reason:"go_to",data:{page_name:"play"}}),await n.timeout(0),o.show_mini_popup(),e.record_state="play",!0),stop_record_playing:async()=>(o.send_msg_to_mini_popup({reason:"go_to",data:{page_name:"stop-playing"}}),await n.timeout(0),o.show_mini_popup(),e.record_state="init",await n.timeout(1e3),o.hide_mini_popup(),!0),mini_popup_ok_click:async()=>(o.hide_mini_popup(),!0)}),document.addEventListener("keydown",(t=>{!function(t){"KeyE"===t.code&&(e.is_e_key_pressed=!0),e.is_e_key_pressed&&t.ctrlKey&&t.shiftKey&&(e.is_combination_pressed=!0,"init"===e.record_state&&window.postMessage({reason:"key_press"},"*"))}(t)})),document.addEventListener("keyup",(t=>{!function(t){"KeyE"===t.code&&(e.is_e_key_pressed=!1),e.is_e_key_pressed&&t.ctrlKey&&t.shiftKey||e.is_combination_pressed&&(e.is_combination_pressed=!1,window.postMessage({reason:"key_up"},"*"))}(t)}))}()})();